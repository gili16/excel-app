{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\landa\\\\Documents\\\\\\u05DC\\u05D9\\u05DE\\u05D5\\u05D3\\u05D9\\u05DD\\\\\\u05EA\\u05DB\\u05E0\\u05D5\\u05EA \\u05D9\\u05D3\\\\react\\\\my-final-project\\\\src\\\\pages\\\\TracksPage.tsx\",\n  _s = $RefreshSig$();\nimport { useEffect, useState } from \"react\";\nimport TrackFind from \"../sections/TrackFind.section\";\nimport { useLoaderData } from \"react-router-dom\";\nimport { getTrackByArea } from \"../services/track\";\nimport { useSelector } from \"react-redux\";\nimport { selectTrack } from \"../redux/track/track.selector\";\nimport { getAllTracks } from \"../redux/track/track.slice\";\nimport { useAppDispatch, useAppSelector } from \"../redux/store\";\nimport BasicModal from \"../components/Modal.component\";\nimport { selectCompany } from \"../redux/company/company.selector\";\nimport { selectLevel } from \"../redux/level/level.selector\";\nimport { selectDayPart } from \"../redux/dayPart/dayPart.selector\";\nimport { selectView } from \"../redux/view/view.selector\";\nimport { getOptionById } from \"../utils/Mapper\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function TrackPage() {\n  _s();\n  const [desc, setDesc] = useState(undefined);\n  const [filter, setFilter] = useState(undefined);\n  const data = useLoaderData();\n  const [descFavIndex, setDecFavIndex] = useState(undefined);\n  const [incFavIndex, setIncFavIndex] = useState(undefined);\n  const allTracks = useSelector(selectTrack);\n  const dispatch = useAppDispatch();\n  const [lastArea, setLastArea] = useState(\"\");\n  const [tracks, setTracks] = useState([]);\n  const [text, setText] = useState(\"\");\n  const [open, setOpen] = useState(false);\n  const companies = useAppSelector(selectCompany);\n  const levels = useAppSelector(selectLevel);\n  const dayParts = useAppSelector(selectDayPart);\n  const views = useAppSelector(selectView);\n  useEffect(() => {\n    setTracks(data);\n    dispatch(getAllTracks(data));\n  }, []);\n  useEffect(() => {\n    if (descFavIndex !== undefined) {\n      let temp = [];\n      tracks.forEach(value => {\n        let val = {\n          ...value\n        };\n        if (val.id == descFavIndex) {\n          val.favourites -= 1;\n        }\n        temp.push(val);\n      });\n      setTracks([...temp]);\n      setDecFavIndex(undefined);\n    }\n  }, [descFavIndex]);\n  useEffect(() => {\n    if (incFavIndex !== undefined) {\n      let temp = [];\n      tracks.forEach(value => {\n        let val = {\n          ...value\n        };\n        if (val.id == incFavIndex) {\n          val.favourites += 1;\n        }\n        temp.push(val);\n      });\n      setTracks([...temp]);\n      setIncFavIndex(undefined);\n    }\n  }, [incFavIndex]);\n  useEffect(() => {\n    if (desc !== undefined) {\n      loadByDesc();\n    }\n  }, [desc]);\n  useEffect(() => {\n    if (filter !== undefined) {\n      loadByFilter();\n    }\n  }, [filter]);\n  async function loadByDesc() {\n    setOpen(true);\n    setText(\"loading tracks from server\");\n    let temp = await getTackByText(desc);\n    setTracks([...temp]);\n    setDesc(undefined);\n    setText(\"tracks ready\");\n    setOpen(false);\n  }\n  async function loadByFilter() {\n    setOpen(true);\n    setText(\"loading tracks from server\");\n    let temp = [...allTracks];\n    if (lastArea === \"\" || lastArea !== filter.area) {\n      temp = await getTrackByArea(filter.area);\n      setLastArea(filter.area);\n      dispatch(getAllTracks([...temp]));\n    }\n    setText(\"filtering tracks\");\n    let filtered = [...temp.map(value => {\n      if (filter !== undefined && filter !== null) {\n        if (filter.level !== undefined && filter.level !== \"\" && getOptionById(levels, value.levelId) !== filter.level) {\n          return false;\n        }\n        if (filter.dayPart !== undefined && filter.dayPart !== \"\" && getOptionById(dayParts, value.dayPartId) !== filter.dayPart) {\n          return false;\n        }\n        if (filter.company !== undefined && filter.company !== \"\" && getOptionById(companies, value.companyForTripId) !== filter.company) {\n          return false;\n        }\n        if (filter.view !== undefined && filter.view !== \"\" && getOptionById(views, value.viewId) !== filter.view) {\n          return false;\n        }\n      }\n      return value;\n    })];\n    let filteredTracks = [];\n    for (let i = 0; i < filtered.length; i++) {\n      if (filtered[i]) {\n        filteredTracks.push(temp[i]);\n      }\n    }\n    setFilter(undefined);\n    setTracks([...filteredTracks]);\n    setText(\"tracks filtered\");\n    setOpen(false);\n  }\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(BasicModal, {\n      text: text,\n      open: open\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(TrackFind, {\n      tracks: tracks,\n      setDesc: setDesc,\n      setFilter: setFilter,\n      setDecFavIndex: setDecFavIndex,\n      setIncFavIndex: setIncFavIndex\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true);\n}\n_s(TrackPage, \"XLS0Hw5v2IfjUIok6oDwy/MmGRE=\", false, function () {\n  return [useLoaderData, useSelector, useAppDispatch, useAppSelector, useAppSelector, useAppSelector, useAppSelector];\n});\n_c = TrackPage;\nvar _c;\n$RefreshReg$(_c, \"TrackPage\");","map":{"version":3,"names":["useEffect","useState","TrackFind","useLoaderData","getTrackByArea","useSelector","selectTrack","getAllTracks","useAppDispatch","useAppSelector","BasicModal","selectCompany","selectLevel","selectDayPart","selectView","getOptionById","jsxDEV","_jsxDEV","Fragment","_Fragment","TrackPage","_s","desc","setDesc","undefined","filter","setFilter","data","descFavIndex","setDecFavIndex","incFavIndex","setIncFavIndex","allTracks","dispatch","lastArea","setLastArea","tracks","setTracks","text","setText","open","setOpen","companies","levels","dayParts","views","temp","forEach","value","val","id","favourites","push","loadByDesc","loadByFilter","getTackByText","area","filtered","map","level","levelId","dayPart","dayPartId","company","companyForTripId","view","viewId","filteredTracks","i","length","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/landa/Documents/לימודים/תכנות יד/react/my-final-project/src/pages/TracksPage.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport TrackFind from \"../sections/TrackFind.section\";\r\nimport { Filter } from \"../types/Filter.types\";\r\nimport { useLoaderData } from \"react-router-dom\";\r\nimport { Track } from \"../types/Track\";\r\nimport { getTrackByArea, getTrackByText } from \"../services/track\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { selectTrack } from \"../redux/track/track.selector\";\r\nimport { getAllTracks } from \"../redux/track/track.slice\";\r\nimport { useAppDispatch, useAppSelector } from \"../redux/store\";\r\nimport BasicModal from \"../components/Modal.component\";\r\nimport { selectCompany } from \"../redux/company/company.selector\";\r\nimport { selectLevel } from \"../redux/level/level.selector\";\r\nimport { selectDayPart } from \"../redux/dayPart/dayPart.selector\";\r\nimport { selectView } from \"../redux/view/view.selector\";\r\nimport { getOptionById } from \"../utils/Mapper\";\r\n\r\nexport default function TrackPage(){\r\n    const [desc,setDesc]=useState<string|undefined>(undefined)\r\n    const[filter,setFilter]=useState<Filter|undefined>(undefined)\r\n    const data:any=useLoaderData()\r\n    const[descFavIndex,setDecFavIndex]=useState<number|undefined>(undefined)\r\n    const[incFavIndex,setIncFavIndex]=useState<number|undefined>(undefined)\r\n    const allTracks=useSelector(selectTrack)\r\n    const dispatch=useAppDispatch()\r\n    const[lastArea,setLastArea]=useState(\"\")\r\n    const [tracks,setTracks]=useState<Track[]>([])\r\n    const [text, setText]=useState(\"\")\r\n    const [open,setOpen]=useState(false)\r\n    const companies=useAppSelector(selectCompany)\r\n    const levels=useAppSelector(selectLevel)\r\n    const dayParts=useAppSelector(selectDayPart)\r\n    const views=useAppSelector(selectView)\r\n    useEffect(()=>{\r\n        setTracks(data)\r\n        dispatch(getAllTracks(data))\r\n    },[])\r\n    useEffect(()=>{\r\n        if(descFavIndex!==undefined){\r\n            let temp=[] as Track[]\r\n            tracks.forEach((value:Track)=>{\r\n                let val={...value}\r\n                if(val.id==descFavIndex){\r\n                    val.favourites-=1\r\n                }\r\n                temp.push(val)\r\n            });\r\n            setTracks([...temp])\r\n            setDecFavIndex(undefined)\r\n        }\r\n    },[descFavIndex])\r\n    useEffect(()=>{\r\n        if(incFavIndex!==undefined){\r\n            let temp=[] as Track[]\r\n            tracks.forEach((value:Track)=>{\r\n                let val={...value}\r\n                if(val.id==incFavIndex){\r\n                    val.favourites+=1\r\n                }\r\n                temp.push(val)\r\n            });\r\n            setTracks([...temp])\r\n            setIncFavIndex(undefined)\r\n        }\r\n    },[incFavIndex])\r\n    useEffect(()=>{\r\n        if(desc!==undefined){\r\n            loadByDesc();\r\n        }\r\n    },[desc])\r\n    useEffect(()=>{\r\n        if(filter!==undefined){\r\n            loadByFilter();\r\n        }\r\n    },[filter])\r\n    async function loadByDesc(){\r\n        setOpen(true)\r\n        setText(\"loading tracks from server\")\r\n        let temp=await getTackByText(desc!)\r\n        setTracks([...temp])\r\n        setDesc(undefined)\r\n        setText(\"tracks ready\")\r\n        setOpen(false)\r\n\r\n    }\r\n    async function loadByFilter(){\r\n        setOpen(true)\r\n        setText(\"loading tracks from server\")\r\n        let temp=[...allTracks]\r\n        if(lastArea===\"\"||lastArea!==filter!.area){\r\n         temp=await getTrackByArea(filter!.area)\r\n        setLastArea(filter!.area)\r\n        dispatch(getAllTracks([...temp]))\r\n        }\r\n        setText(\"filtering tracks\")\r\n\r\n        let filtered=[...temp!.map((value:Track)=>{\r\n            if(filter!==undefined&&filter!==null){\r\n                if(filter.level!==undefined&&filter.level!==\"\"&&getOptionById(levels,value.levelId)!==filter.level){\r\n                    return false;\r\n                }\r\n                if(filter.dayPart!==undefined&&filter.dayPart!==\"\"&&getOptionById(dayParts,value.dayPartId)!==filter.dayPart){\r\n                    return false;\r\n                }\r\n                if(filter.company!==undefined&&filter.company!==\"\"&&getOptionById(companies,value.companyForTripId)!==filter.company){\r\n                    return false;\r\n                }\r\n                if(filter.view!==undefined&&filter.view!==\"\"&&getOptionById(views,value.viewId)!==filter.view){\r\n                    return false;\r\n                }\r\n            }\r\n            return value;\r\n        })];\r\n        let filteredTracks=[]as Track[]\r\n        for(let i=0;i<filtered.length;i++){\r\n            if(filtered[i]){\r\n                filteredTracks.push(temp[i])\r\n            }\r\n        }\r\n        setFilter(undefined)\r\n        setTracks([...filteredTracks])\r\n       \r\n        setText(\"tracks filtered\")\r\n        setOpen(false)\r\n    }\r\n\r\n    \r\n    return <>\r\n    <BasicModal text={text} open={open}/>\r\n    <TrackFind tracks={tracks} setDesc={setDesc} setFilter={setFilter} setDecFavIndex={setDecFavIndex} setIncFavIndex={setIncFavIndex}/>\r\n    </>\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}