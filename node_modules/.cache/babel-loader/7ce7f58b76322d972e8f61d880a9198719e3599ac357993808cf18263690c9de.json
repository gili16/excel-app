{"ast":null,"code":"import { PATHS } from \"../routes/paths\";\nimport { getUserByToken } from \"../services/user\";\nimport axios from \"../utils/axios\";\nexport const setSession = user => {\n  localStorage.setItem('user', JSON.stringify(user.token));\n  axios.defaults.headers.common.Authorization = `Bearer ${user.token}`;\n};\nexport const setAuthorizationHeader = token => {\n  axios.defaults.headers.common.Authorization = `Bearer ${token}`;\n};\nexport const getSession = async () => {\n  const user = JSON.parse(localStorage.getItem('user') || 'null');\n  if (user) {\n    let response = await getUserByToken(user);\n    if (response.status === 200) {\n      let myUser = await response.json();\n      return myUser;\n    }\n  }\n  return null;\n};\nexport const removeSession = () => {\n  localStorage.removeItem('user');\n  axios.defaults.headers.common.Authorization = undefined;\n  window.location.href = PATHS.login;\n};\nexport function jwtDecode(token) {\n  const base64Url = token.split('.')[1];\n  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(c => `%${`00${c.charCodeAt(0).toString(16)}`.slice(-2)}`).join(''));\n  return JSON.parse(jsonPayload);\n}\nexport const isValidToken = token => {\n  if (!token) {\n    return false;\n  }\n  const decoded = jwtDecode(token);\n  const currentTime = Date.now() / 1000;\n  return decoded.exp > currentTime;\n};","map":{"version":3,"names":["PATHS","getUserByToken","axios","setSession","user","localStorage","setItem","JSON","stringify","token","defaults","headers","common","Authorization","setAuthorizationHeader","getSession","parse","getItem","response","status","myUser","json","removeSession","removeItem","undefined","window","location","href","login","jwtDecode","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","isValidToken","decoded","currentTime","Date","now","exp"],"sources":["C:/Users/landa/Documents/לימודים/תכנות יד/react/my-final-project/src/auth/auth.utils.ts"],"sourcesContent":["import { PATHS } from \"../routes/paths\";\r\nimport { getUserByToken } from \"../services/user\";\r\nimport { AuthUser } from \"../types/user.types\";\r\nimport axios from \"../utils/axios\";\r\n\r\nexport const setSession = (user: AuthUser) => {\r\n    localStorage.setItem('user', JSON.stringify(user.token))\r\n    axios.defaults.headers.common.Authorization = `Bearer ${user.token}`\r\n}\r\n\r\nexport const setAuthorizationHeader = (token: string) => {\r\n    axios.defaults.headers.common.Authorization = `Bearer ${token}`\r\n}\r\n\r\nexport const getSession =async(): Promise<AuthUser | null> => {\r\n    const user = JSON.parse(localStorage.getItem('user') || 'null')\r\n    if(user){\r\n        let response=await getUserByToken(user);\r\n        if(response.status===200){\r\n            let myUser=await response.json()\r\n            return myUser;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nexport const removeSession = () => {\r\n    localStorage.removeItem('user');\r\n    axios.defaults.headers.common.Authorization = undefined;\r\n    window.location.href = PATHS.login;\r\n}\r\n\r\nexport function jwtDecode(token: string) {\r\n    const base64Url = token.split('.')[1];\r\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n    const jsonPayload = decodeURIComponent(\r\n        window\r\n            .atob(base64)\r\n            .split('')\r\n            .map((c) => `%${`00${c.charCodeAt(0).toString(16)}`.slice(-2)}`)\r\n            .join('')\r\n    );\r\n\r\n    return JSON.parse(jsonPayload);\r\n}\r\n\r\n\r\nexport const isValidToken = (token: string|null) => {\r\n    if (!token) {\r\n        return false;\r\n    }\r\n\r\n    const decoded = jwtDecode(token);\r\n\r\n    const currentTime = Date.now() / 1000;\r\n\r\n    return decoded.exp > currentTime;\r\n};\r\n"],"mappings":"AAAA,SAASA,KAAK,QAAQ,iBAAiB;AACvC,SAASC,cAAc,QAAQ,kBAAkB;AAEjD,OAAOC,KAAK,MAAM,gBAAgB;AAElC,OAAO,MAAMC,UAAU,GAAIC,IAAc,IAAK;EAC1CC,YAAY,CAACC,OAAO,CAAC,MAAM,EAAEC,IAAI,CAACC,SAAS,CAACJ,IAAI,CAACK,KAAK,CAAC,CAAC;EACxDP,KAAK,CAACQ,QAAQ,CAACC,OAAO,CAACC,MAAM,CAACC,aAAa,GAAI,UAAST,IAAI,CAACK,KAAM,EAAC;AACxE,CAAC;AAED,OAAO,MAAMK,sBAAsB,GAAIL,KAAa,IAAK;EACrDP,KAAK,CAACQ,QAAQ,CAACC,OAAO,CAACC,MAAM,CAACC,aAAa,GAAI,UAASJ,KAAM,EAAC;AACnE,CAAC;AAED,OAAO,MAAMM,UAAU,GAAE,MAAAA,CAAA,KAAqC;EAC1D,MAAMX,IAAI,GAAGG,IAAI,CAACS,KAAK,CAACX,YAAY,CAACY,OAAO,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC;EAC/D,IAAGb,IAAI,EAAC;IACJ,IAAIc,QAAQ,GAAC,MAAMjB,cAAc,CAACG,IAAI,CAAC;IACvC,IAAGc,QAAQ,CAACC,MAAM,KAAG,GAAG,EAAC;MACrB,IAAIC,MAAM,GAAC,MAAMF,QAAQ,CAACG,IAAI,CAAC,CAAC;MAChC,OAAOD,MAAM;IACjB;EACJ;EACA,OAAO,IAAI;AACf,CAAC;AAED,OAAO,MAAME,aAAa,GAAGA,CAAA,KAAM;EAC/BjB,YAAY,CAACkB,UAAU,CAAC,MAAM,CAAC;EAC/BrB,KAAK,CAACQ,QAAQ,CAACC,OAAO,CAACC,MAAM,CAACC,aAAa,GAAGW,SAAS;EACvDC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG3B,KAAK,CAAC4B,KAAK;AACtC,CAAC;AAED,OAAO,SAASC,SAASA,CAACpB,KAAa,EAAE;EACrC,MAAMqB,SAAS,GAAGrB,KAAK,CAACsB,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;EACrC,MAAMC,MAAM,GAAGF,SAAS,CAACG,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC;EAC9D,MAAMC,WAAW,GAAGC,kBAAkB,CAClCV,MAAM,CACDW,IAAI,CAACJ,MAAM,CAAC,CACZD,KAAK,CAAC,EAAE,CAAC,CACTM,GAAG,CAAEC,CAAC,IAAM,IAAI,KAAIA,CAAC,CAACC,UAAU,CAAC,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAE,EAAC,CAACC,KAAK,CAAC,CAAC,CAAC,CAAE,EAAC,CAAC,CAC/DC,IAAI,CAAC,EAAE,CAChB,CAAC;EAED,OAAOnC,IAAI,CAACS,KAAK,CAACkB,WAAW,CAAC;AAClC;AAGA,OAAO,MAAMS,YAAY,GAAIlC,KAAkB,IAAK;EAChD,IAAI,CAACA,KAAK,EAAE;IACR,OAAO,KAAK;EAChB;EAEA,MAAMmC,OAAO,GAAGf,SAAS,CAACpB,KAAK,CAAC;EAEhC,MAAMoC,WAAW,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI;EAErC,OAAOH,OAAO,CAACI,GAAG,GAAGH,WAAW;AACpC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}