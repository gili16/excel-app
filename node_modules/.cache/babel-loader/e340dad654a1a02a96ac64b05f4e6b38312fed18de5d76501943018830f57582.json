{"ast":null,"code":"import { getSession, isValidToken, removeSession } from \"../auth/auth.utils\";\nimport { ENDPOINTS } from \"../api/endpoints\";\nexport const authRequestMiddleware = async request => {\n  alert(ENDPOINTS.user.base + ENDPOINTS.user.getUserByToken);\n  if (request.url !== ENDPOINTS.user.base + ENDPOINTS.user.getUserByToken) {\n    var _request$url, _request$url2, _request$url3, _request$url4;\n    const user = await getSession();\n    if (request.url !== ENDPOINTS.user.base + ENDPOINTS.user.add && ((_request$url = request.url) === null || _request$url === void 0 ? void 0 : _request$url.substring(0, ((_request$url2 = request.url) === null || _request$url2 === void 0 ? void 0 : _request$url2.lastIndexOf(\"/\")) + 1)) !== ENDPOINTS.track.base + ENDPOINTS.track.getTracksByArea && ((_request$url3 = request.url) === null || _request$url3 === void 0 ? void 0 : _request$url3.substring(0, ((_request$url4 = request.url) === null || _request$url4 === void 0 ? void 0 : _request$url4.lastIndexOf(\"/\")) + 1)) !== ENDPOINTS.track.base + ENDPOINTS.track.getTracksByOption && request.url !== ENDPOINTS.track.base + ENDPOINTS.track.getTracksByText && request.url !== ENDPOINTS.track.base + ENDPOINTS.track.getAll) {\n      if (!user || !isValidToken(user.token)) {\n        removeSession();\n        Promise.reject('Unauthorized');\n      }\n    }\n  }\n  return request;\n};\nexport const authResponseMiddleware = response => {\n  if (response.status === 401) {\n    alert(\"response\");\n    removeSession();\n    Promise.reject('Unauthorized');\n  }\n  return response;\n};","map":{"version":3,"names":["getSession","isValidToken","removeSession","ENDPOINTS","authRequestMiddleware","request","alert","user","base","getUserByToken","url","_request$url","_request$url2","_request$url3","_request$url4","add","substring","lastIndexOf","track","getTracksByArea","getTracksByOption","getTracksByText","getAll","token","Promise","reject","authResponseMiddleware","response","status"],"sources":["C:/Users/landa/Documents/לימודים/תכנות יד/react/my-final-project/src/utils/authMiddleware.ts"],"sourcesContent":["import { InternalAxiosRequestConfig, AxiosResponse } from \"axios\";\r\nimport { getSession, isValidToken, removeSession } from \"../auth/auth.utils\"\r\nimport { ENDPOINTS, baseUrl } from \"../api/endpoints\";\r\n\r\nexport const authRequestMiddleware = async (request: InternalAxiosRequestConfig) => {\r\n    alert(ENDPOINTS.user.base+ENDPOINTS.user.getUserByToken)\r\n    if (request.url !== ENDPOINTS.user.base+ENDPOINTS.user.getUserByToken) {\r\n        const user = await getSession()\r\n        if (request.url !== ENDPOINTS.user.base+ENDPOINTS.user.add && request.url?.substring(0, request.url?.lastIndexOf(\"/\") + 1) !== ENDPOINTS.track.base+ENDPOINTS.track.getTracksByArea && request.url?.substring(0, request.url?.lastIndexOf(\"/\") + 1) !== ENDPOINTS.track.base+ENDPOINTS.track.getTracksByOption && request.url !== ENDPOINTS.track.base+ENDPOINTS.track.getTracksByText&& request.url !== ENDPOINTS.track.base+ENDPOINTS.track.getAll) {\r\n            if (!user || !isValidToken(user.token)) {\r\n                removeSession();\r\n                Promise.reject('Unauthorized')\r\n            }\r\n        }\r\n    }\r\n    return request\r\n}\r\n\r\nexport const authResponseMiddleware = (response: AxiosResponse) => {\r\n    if (response.status === 401) {\r\n        alert(\"response\")\r\n        removeSession();\r\n        Promise.reject('Unauthorized')\r\n    }\r\n    return response\r\n}"],"mappings":"AACA,SAASA,UAAU,EAAEC,YAAY,EAAEC,aAAa,QAAQ,oBAAoB;AAC5E,SAASC,SAAS,QAAiB,kBAAkB;AAErD,OAAO,MAAMC,qBAAqB,GAAG,MAAOC,OAAmC,IAAK;EAChFC,KAAK,CAACH,SAAS,CAACI,IAAI,CAACC,IAAI,GAACL,SAAS,CAACI,IAAI,CAACE,cAAc,CAAC;EACxD,IAAIJ,OAAO,CAACK,GAAG,KAAKP,SAAS,CAACI,IAAI,CAACC,IAAI,GAACL,SAAS,CAACI,IAAI,CAACE,cAAc,EAAE;IAAA,IAAAE,YAAA,EAAAC,aAAA,EAAAC,aAAA,EAAAC,aAAA;IACnE,MAAMP,IAAI,GAAG,MAAMP,UAAU,CAAC,CAAC;IAC/B,IAAIK,OAAO,CAACK,GAAG,KAAKP,SAAS,CAACI,IAAI,CAACC,IAAI,GAACL,SAAS,CAACI,IAAI,CAACQ,GAAG,IAAI,EAAAJ,YAAA,GAAAN,OAAO,CAACK,GAAG,cAAAC,YAAA,uBAAXA,YAAA,CAAaK,SAAS,CAAC,CAAC,EAAE,EAAAJ,aAAA,GAAAP,OAAO,CAACK,GAAG,cAAAE,aAAA,uBAAXA,aAAA,CAAaK,WAAW,CAAC,GAAG,CAAC,IAAG,CAAC,CAAC,MAAKd,SAAS,CAACe,KAAK,CAACV,IAAI,GAACL,SAAS,CAACe,KAAK,CAACC,eAAe,IAAI,EAAAN,aAAA,GAAAR,OAAO,CAACK,GAAG,cAAAG,aAAA,uBAAXA,aAAA,CAAaG,SAAS,CAAC,CAAC,EAAE,EAAAF,aAAA,GAAAT,OAAO,CAACK,GAAG,cAAAI,aAAA,uBAAXA,aAAA,CAAaG,WAAW,CAAC,GAAG,CAAC,IAAG,CAAC,CAAC,MAAKd,SAAS,CAACe,KAAK,CAACV,IAAI,GAACL,SAAS,CAACe,KAAK,CAACE,iBAAiB,IAAIf,OAAO,CAACK,GAAG,KAAKP,SAAS,CAACe,KAAK,CAACV,IAAI,GAACL,SAAS,CAACe,KAAK,CAACG,eAAe,IAAGhB,OAAO,CAACK,GAAG,KAAKP,SAAS,CAACe,KAAK,CAACV,IAAI,GAACL,SAAS,CAACe,KAAK,CAACI,MAAM,EAAE;MAClb,IAAI,CAACf,IAAI,IAAI,CAACN,YAAY,CAACM,IAAI,CAACgB,KAAK,CAAC,EAAE;QACpCrB,aAAa,CAAC,CAAC;QACfsB,OAAO,CAACC,MAAM,CAAC,cAAc,CAAC;MAClC;IACJ;EACJ;EACA,OAAOpB,OAAO;AAClB,CAAC;AAED,OAAO,MAAMqB,sBAAsB,GAAIC,QAAuB,IAAK;EAC/D,IAAIA,QAAQ,CAACC,MAAM,KAAK,GAAG,EAAE;IACzBtB,KAAK,CAAC,UAAU,CAAC;IACjBJ,aAAa,CAAC,CAAC;IACfsB,OAAO,CAACC,MAAM,CAAC,cAAc,CAAC;EAClC;EACA,OAAOE,QAAQ;AACnB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}