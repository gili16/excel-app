{"ast":null,"code":"import { PATHS } from \"../routes/paths\";\nimport { getUserByToken } from \"../services/user\";\nimport axios from \"../utils/axios\";\nexport const setSession = user => {\n  localStorage.setItem('user', user.token);\n  axios.defaults.headers.common.Authorization = `Bearer ${user.token}`;\n};\nexport const setAuthorizationHeader = token => {\n  axios.defaults.headers.common.Authorization = `Bearer ${token}`;\n};\nexport const getSession = async () => {\n  const user = localStorage.getItem('user');\n  let response = null;\n  if (user) {\n    let response = await getUserByToken(user);\n    console.log(response);\n    if (response.status === 200) {\n      let myUser = await response.json();\n      response = myUser;\n    }\n  } else {\n    return null;\n  }\n  return response;\n};\nexport const removeSession = () => {\n  localStorage.removeItem('user');\n  axios.defaults.headers.common.Authorization = undefined;\n  window.location.href = PATHS.login;\n};\nexport function jwtDecode(token) {\n  const base64Url = token.split('.')[1];\n  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(c => `%${`00${c.charCodeAt(0).toString(16)}`.slice(-2)}`).join(''));\n  return JSON.parse(jsonPayload);\n}\nexport const isValidToken = token => {\n  if (!token) {\n    return false;\n  }\n  const decoded = jwtDecode(token);\n  const currentTime = Date.now() / 1000;\n  return decoded.exp > currentTime;\n};","map":{"version":3,"names":["PATHS","getUserByToken","axios","setSession","user","localStorage","setItem","token","defaults","headers","common","Authorization","setAuthorizationHeader","getSession","getItem","response","console","log","status","myUser","json","removeSession","removeItem","undefined","window","location","href","login","jwtDecode","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","isValidToken","decoded","currentTime","Date","now","exp"],"sources":["C:/Users/landa/Documents/לימודים/תכנות יד/react/my-final-project/src/auth/auth.utils.ts"],"sourcesContent":["import { PATHS } from \"../routes/paths\";\r\nimport { getUserByToken } from \"../services/user\";\r\nimport { AuthUser } from \"../types/user.types\";\r\nimport axios from \"../utils/axios\";\r\n\r\nexport const setSession = (user: AuthUser) => {\r\n    localStorage.setItem('user', user.token)\r\n    axios.defaults.headers.common.Authorization = `Bearer ${user.token}`\r\n}\r\n\r\nexport const setAuthorizationHeader = (token: string) => {\r\n    axios.defaults.headers.common.Authorization = `Bearer ${token}`\r\n}\r\n\r\nexport const getSession = async (): Promise<AuthUser | null> => {\r\n    const user = localStorage.getItem('user')\r\n    let response=null;\r\n    if (user) {\r\n        let response = await getUserByToken(user);\r\n        console.log(response)\r\n        if (response.status === 200) {\r\n            let myUser = await response.json()\r\n            response= myUser;\r\n        }\r\n    } else {\r\n        return null;\r\n    }\r\n    return response;\r\n}\r\n\r\nexport const removeSession = () => {\r\n    localStorage.removeItem('user');\r\n    axios.defaults.headers.common.Authorization = undefined;\r\n    window.location.href = PATHS.login;\r\n}\r\n\r\nexport function jwtDecode(token: string) {\r\n    const base64Url = token.split('.')[1];\r\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n    const jsonPayload = decodeURIComponent(\r\n        window\r\n            .atob(base64)\r\n            .split('')\r\n            .map((c) => `%${`00${c.charCodeAt(0).toString(16)}`.slice(-2)}`)\r\n            .join('')\r\n    );\r\n\r\n    return JSON.parse(jsonPayload);\r\n}\r\n\r\n\r\nexport const isValidToken = (token: string | null) => {\r\n    if (!token) {\r\n        return false;\r\n    }\r\n\r\n    const decoded = jwtDecode(token);\r\n\r\n    const currentTime = Date.now() / 1000;\r\n\r\n    return decoded.exp > currentTime;\r\n};\r\n"],"mappings":"AAAA,SAASA,KAAK,QAAQ,iBAAiB;AACvC,SAASC,cAAc,QAAQ,kBAAkB;AAEjD,OAAOC,KAAK,MAAM,gBAAgB;AAElC,OAAO,MAAMC,UAAU,GAAIC,IAAc,IAAK;EAC1CC,YAAY,CAACC,OAAO,CAAC,MAAM,EAAEF,IAAI,CAACG,KAAK,CAAC;EACxCL,KAAK,CAACM,QAAQ,CAACC,OAAO,CAACC,MAAM,CAACC,aAAa,GAAI,UAASP,IAAI,CAACG,KAAM,EAAC;AACxE,CAAC;AAED,OAAO,MAAMK,sBAAsB,GAAIL,KAAa,IAAK;EACrDL,KAAK,CAACM,QAAQ,CAACC,OAAO,CAACC,MAAM,CAACC,aAAa,GAAI,UAASJ,KAAM,EAAC;AACnE,CAAC;AAED,OAAO,MAAMM,UAAU,GAAG,MAAAA,CAAA,KAAsC;EAC5D,MAAMT,IAAI,GAAGC,YAAY,CAACS,OAAO,CAAC,MAAM,CAAC;EACzC,IAAIC,QAAQ,GAAC,IAAI;EACjB,IAAIX,IAAI,EAAE;IACN,IAAIW,QAAQ,GAAG,MAAMd,cAAc,CAACG,IAAI,CAAC;IACzCY,OAAO,CAACC,GAAG,CAACF,QAAQ,CAAC;IACrB,IAAIA,QAAQ,CAACG,MAAM,KAAK,GAAG,EAAE;MACzB,IAAIC,MAAM,GAAG,MAAMJ,QAAQ,CAACK,IAAI,CAAC,CAAC;MAClCL,QAAQ,GAAEI,MAAM;IACpB;EACJ,CAAC,MAAM;IACH,OAAO,IAAI;EACf;EACA,OAAOJ,QAAQ;AACnB,CAAC;AAED,OAAO,MAAMM,aAAa,GAAGA,CAAA,KAAM;EAC/BhB,YAAY,CAACiB,UAAU,CAAC,MAAM,CAAC;EAC/BpB,KAAK,CAACM,QAAQ,CAACC,OAAO,CAACC,MAAM,CAACC,aAAa,GAAGY,SAAS;EACvDC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG1B,KAAK,CAAC2B,KAAK;AACtC,CAAC;AAED,OAAO,SAASC,SAASA,CAACrB,KAAa,EAAE;EACrC,MAAMsB,SAAS,GAAGtB,KAAK,CAACuB,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;EACrC,MAAMC,MAAM,GAAGF,SAAS,CAACG,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC;EAC9D,MAAMC,WAAW,GAAGC,kBAAkB,CAClCV,MAAM,CACDW,IAAI,CAACJ,MAAM,CAAC,CACZD,KAAK,CAAC,EAAE,CAAC,CACTM,GAAG,CAAEC,CAAC,IAAM,IAAI,KAAIA,CAAC,CAACC,UAAU,CAAC,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAE,EAAC,CAACC,KAAK,CAAC,CAAC,CAAC,CAAE,EAAC,CAAC,CAC/DC,IAAI,CAAC,EAAE,CAChB,CAAC;EAED,OAAOC,IAAI,CAACC,KAAK,CAACV,WAAW,CAAC;AAClC;AAGA,OAAO,MAAMW,YAAY,GAAIrC,KAAoB,IAAK;EAClD,IAAI,CAACA,KAAK,EAAE;IACR,OAAO,KAAK;EAChB;EAEA,MAAMsC,OAAO,GAAGjB,SAAS,CAACrB,KAAK,CAAC;EAEhC,MAAMuC,WAAW,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI;EAErC,OAAOH,OAAO,CAACI,GAAG,GAAGH,WAAW;AACpC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}