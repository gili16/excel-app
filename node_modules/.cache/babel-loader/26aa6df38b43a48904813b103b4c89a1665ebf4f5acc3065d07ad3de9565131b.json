{"ast":null,"code":"import { addTrack as addTrackApi, deleteTrack as deleteTrackApi } from \"../../services/track\";\nimport { addTrack as addTrackAction, addStop as addStopAction, addComment as addCommentAction, deleteTrack as deleteTrackActionForTrack } from \"./track.slice\";\nimport { Login } from \"../user/user.thunk\";\nimport { addStop as addStopApi } from \"../../services/stop\";\nimport { deleteTrack as deleteTrackActionForUser } from \"../user/user.slice\";\nimport { addComment as addCommentApi, getCommentsByTrackId } from \"../../services/comment\";\nexport const addTrack = track => async (dispatch, getState) => {\n  try {\n    let response = await addTrackApi(track);\n    if (response.status === 401) {\n      const state = getState();\n      Login(state.user.user.mail);\n      response = await addTrackApi(track);\n    }\n    const newTrack = response.data;\n    dispatch(addTrackAction(newTrack));\n    return newTrack;\n  } catch (error) {\n    alert(\"failed to add\");\n    return null;\n  }\n};\nexport const addStop = stop => async (dispatch, getState) => {\n  try {\n    let response = await addStopApi(stop);\n    if (response.status === 401) {\n      const state = getState();\n      Login(state.user.user.mail);\n      response = await addStopApi(stop);\n    }\n    const newStop = response.data;\n    dispatch(addStopAction(newStop));\n    return newStop;\n  } catch (error) {\n    alert(\"failed to add\");\n    return null;\n  }\n};\nexport const addComment = comment => async (dispatch, getState) => {\n  let response = await addCommentApi(comment);\n  dispatch(addCommentAction({\n    trackId: response.trackId,\n    comment: response\n  }));\n  return response;\n};\nexport const initComments = trackId => async (dispatch, getState) => {\n  let response = await getCommentsByTrackId(trackId);\n  response.forEach(value => {\n    dispatch(addCommentAction({\n      trackId: trackId,\n      comment: value\n    }));\n  });\n  return response;\n};\nexport const deleteTrack = trackId => async (dispatch, getState) => {\n  await deleteTrackApi(trackId);\n  alert(\"delete was successfull\");\n  dispatch(deleteTrackActionForTrack(trackId));\n  dispatch(deleteTrackActionForUser(trackId));\n};","map":{"version":3,"names":["addTrack","addTrackApi","deleteTrack","deleteTrackApi","addTrackAction","addStop","addStopAction","addComment","addCommentAction","deleteTrackActionForTrack","Login","addStopApi","deleteTrackActionForUser","addCommentApi","getCommentsByTrackId","track","dispatch","getState","response","status","state","user","mail","newTrack","data","error","alert","stop","newStop","comment","trackId","initComments","forEach","value"],"sources":["C:/Users/landa/Documents/לימודים/תכנות יד/react/my-final-project/src/redux/track/track.thunk.ts"],"sourcesContent":["import { User } from \"../../types/user.types\";\r\nimport { Track } from \"../../types/Track\";\r\nimport { AppThunk } from \"../store\";\r\nimport { addTrack as addTrackApi, deleteTrack as deleteTrackApi } from \"../../services/track\";\r\nimport { addTrack as addTrackAction, addStop as addStopAction, addComment as addCommentAction, deleteTrack as deleteTrackActionForTrack } from \"./track.slice\";\r\nimport { Login } from \"../user/user.thunk\";\r\nimport { Stop } from \"../../types/Stop\";\r\nimport { addStop as addStopApi } from \"../../services/stop\";\r\nimport { Comment } from \"../../types/Comment\";\r\nimport { deleteTrack as deleteTrackActionForUser } from \"../user/user.slice\";\r\nimport { addComment as addCommentApi, getCommentsByTrackId } from \"../../services/comment\";\r\nexport const addTrack = (track: FormData): AppThunk<Track> => async (dispatch, getState) => {\r\n\r\n    try {\r\n        let response = await addTrackApi(track);\r\n        if (response.status === 401) {\r\n            const state = getState()\r\n            Login(state.user!.user!.mail)\r\n            response = await addTrackApi(track);\r\n        }\r\n        const newTrack = response.data\r\n        dispatch(addTrackAction(newTrack))\r\n        return newTrack;\r\n    } catch (error) {\r\n\r\n        alert(\"failed to add\")\r\n        return null;\r\n    }\r\n}\r\nexport const addStop = (stop: Omit<Stop, 'id'>): AppThunk<Track> => async (dispatch, getState) => {\r\n\r\n    try {\r\n        let response = await addStopApi(stop);\r\n        if (response.status === 401) {\r\n            const state = getState()\r\n            Login(state.user!.user!.mail)\r\n            response = await addStopApi(stop);\r\n        }\r\n        const newStop = response.data\r\n        dispatch(addStopAction(newStop))\r\n        return newStop;\r\n    } catch (error) {\r\n\r\n        alert(\"failed to add\")\r\n        return null;\r\n    }\r\n}\r\nexport const addComment = (comment: Omit<Comment, 'id'>): AppThunk<Comment> => async (dispatch, getState) => {\r\n    let response = await addCommentApi(comment) as Comment\r\n    dispatch(addCommentAction({ trackId: response.trackId, comment: response }))\r\n    return response\r\n\r\n}\r\nexport const initComments = (trackId: number): AppThunk<Comment[]> => async (dispatch, getState) => {\r\n    let response = await getCommentsByTrackId(trackId) as Comment[]\r\n    response.forEach(value => {\r\n        dispatch(addCommentAction({ trackId: trackId, comment: value }))\r\n    })\r\n    return response\r\n\r\n}\r\n\r\nexport const deleteTrack = (trackId: number): AppThunk<void> => async (dispatch, getState) => {\r\n    await deleteTrackApi(trackId)\r\n    alert(\"delete was successfull\")\r\n    dispatch(deleteTrackActionForTrack(trackId))\r\n    dispatch(deleteTrackActionForUser(trackId))\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}